- id: BedroomCubeShakeAlertToggleBedroomLights
  alias: Bedroom Cube / Shake / Toggle Bedroom Lights
  trigger:
  - platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.bedroom_cube
      action_type: shake_air
  action:
  - service: light.toggle
    data:
      entity_id: 
        - light.bedroom_bulb_1
        - light.bedroom_bulb_2
      brightness: 50
      transition: 1
  - service: light.turn_off
    entity_id: light.hall_bulb
  mode: single

- id: BedroomCubeFlip90ToggleBedroomLight1
  alias: Bedroom Cube / Flip90 / Toggle Bedroom Light 1
  trigger:
  - platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.bedroom_cube
      action_type: flip90
  action:
  - service: light.toggle
    data:
      entity_id: light.bedroom_bulb_1
      brightness: 50
      transition: 1
  mode: single

- id: BedroomCubeFlip180ToggleBedroomLight2
  alias: Bedroom Cube / Flip180 / Toggle Bedroom Light 2
  trigger:
  - platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.bedroom_cube
      action_type: flip180
  action:
  - service: light.toggle
    data:
      entity_id: light.bedroom_bulb_2
      brightness: 50
      transition: 1
  mode: single

- id: BedroomCubeTapTwiceSwitchOffBedroomAndHallLights
  alias: Bedroom Cube / Tap Twice / Switch Off Bedroom and Hall Lights 
  trigger:
  - platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.bedroom_cube
      action_type: tap_twice
  action:
  - service: script.turn_off_bedroom_lights
  - service: script.turn_off_hall_light
  mode: single

#################################################################
# @Automation
# @Room: Master Bedroom
# @Description: Increases/Decreases Light brightness depending
# on cube rotation. 
# @Device: Aqara Magic Cube
# @Device_URL: https://www.aqara.com/us/cube.html
# @Device: Yeelight LED Bulb 1S (White)
# @Device_URL: https://en.yeelight.com/product/819.html
# @Trigger: Bedroom Cube Rotate
# @Action: Increase/Decrease Light Brightness
#################################################################
- id: BedroomCubeRotateBrightnessBedroomLights
  alias: Bedroom Cube / Rotate / Brightness Bedroom Lights
  description: 'Increases/Decreases Light brightness depending on cube rotation.'
  trigger:
  - platform: event
    event_type: xiaomi_aqara.cube_action
    event_data:
      entity_id: binary_sensor.bedroom_cube
      action_type: rotate
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.bedroom_bulb_1
        - light.bedroom_bulb_2
      brightness: >
        {% set state = state_attr('light.bedroom_bulb_1','brightness') -%}
        {%-  if (state == None) and (trigger.event.data.action_value|int > 20) -%}
            {%- set state = 50 -%}
        {%-  elif trigger.event.data.action_value|int > 0 -%}
            {%- set state = state_attr('light.bedroom_bulb_1','brightness') + 100 -%}
        {%-  elif trigger.event.data.action_value|int < 0 -%}
            {%- set state = state_attr('light.bedroom_bulb_1','brightness') - 100 -%}
        {%- endif %}
        {{ state }}
  mode: single